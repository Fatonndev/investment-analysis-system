
<script>
// Store current tab in session storage to preserve state across page reloads
function setCurrentTab(tabName) {
    sessionStorage.setItem('currentDataInputTab', tabName);
}

// Get current tab from session storage
function getCurrentTab() {
    return sessionStorage.getItem('currentDataInputTab');
}

document.addEventListener('DOMContentLoaded', function() {
    // Tab functionality
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            // Remove active class from all buttons and panes
            tabBtns.forEach(b => b.classList.remove('active'));
            tabPanes.forEach(p => p.classList.remove('active'));
            
            // Add active class to clicked button
            btn.classList.add('active');
            
            // Show corresponding pane
            const tabId = btn.getAttribute('data-tab') + '-tab';
            document.getElementById(tabId).classList.add('active');
            
            // Store the current tab in session storage
            const tabName = btn.getAttribute('data-tab');
            setCurrentTab(tabName);
        });
    });
    
    // Cost type selection functionality
    function toggleCostFields() {
        const costType = document.getElementById('cost_type').value;
        document.getElementById('raw-material-fields').style.display = 'none';
        document.getElementById('energy-fields').style.display = 'none';
        document.getElementById('logistics-fields').style.display = 'none';
        document.getElementById('labor-fields').style.display = 'none';
        document.getElementById('depreciation-fields').style.display = 'none';

        if (costType === 'raw_material') {
            document.getElementById('raw-material-fields').style.display = 'block';
        } else if (costType === 'energy') {
            document.getElementById('energy-fields').style.display = 'block';
        } else if (costType === 'logistics') {
            document.getElementById('logistics-fields').style.display = 'block';
        } else if (costType === 'labor') {
            document.getElementById('labor-fields').style.display = 'block';
        } else if (costType === 'depreciation') {
            document.getElementById('depreciation-fields').style.display = 'block';
        }
    }
    
    // Set initial state
    toggleCostFields();
    
    // Check URL parameter to activate the correct tab (highest priority)
    const urlParams = new URLSearchParams(window.location.search);
    const activeTab = urlParams.get('tab');
    
    if (activeTab) {
        // Remove active class from all buttons and panes
        tabBtns.forEach(b => b.classList.remove('active'));
        tabPanes.forEach(p => p.classList.remove('active'));
        
        // Find and activate the requested tab
        const targetBtn = document.querySelector(`.tab-btn[data-tab="${activeTab}"]`);
        const targetPane = document.getElementById(`${activeTab}-tab`);
        
        if (targetBtn && targetPane) {
            targetBtn.classList.add('active');
            targetPane.classList.add('active');
            
            // Also store in session storage
            setCurrentTab(activeTab);
        }
    } else {
        // If no URL parameter, check session storage
        const storedTab = getCurrentTab();
        if (storedTab) {
            // Remove active class from all buttons and panes
            tabBtns.forEach(b => b.classList.remove('active'));
            tabPanes.forEach(p => p.classList.remove('active'));
            
            // Find and activate the stored tab
            const targetBtn = document.querySelector(`.tab-btn[data-tab="${storedTab}"]`);
            const targetPane = document.getElementById(`${storedTab}-tab`);
            
            if (targetBtn && targetPane) {
                targetBtn.classList.add('active');
                targetPane.classList.add('active');
            }
        }
    }
});

